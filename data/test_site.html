<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FixOnce - ××¢×‘×“×ª ×‘×“×™×§×•×ª</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #81b29a, #5e81ac);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }

        /* Scenarios Grid */
        .scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .scenario-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
        }
        .scenario-card:hover {
            border-color: rgba(129, 178, 154, 0.5);
            transform: translateY(-2px);
        }
        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .scenario-num {
            font-size: 0.7rem;
            padding: 3px 8px;
            background: rgba(94, 129, 172, 0.3);
            border-radius: 10px;
            color: #5e81ac;
        }
        .scenario-lang {
            font-size: 0.65rem;
            padding: 2px 6px;
            background: rgba(231, 111, 81, 0.2);
            border-radius: 8px;
            color: #e76f51;
        }
        .scenario-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }
        .scenario-desc {
            font-size: 0.85rem;
            color: #888;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        .scenario-file {
            font-family: monospace;
            font-size: 0.75rem;
            color: #5e81ac;
            background: rgba(94, 129, 172, 0.1);
            padding: 6px 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            word-break: break-all;
        }
        .scenario-actions {
            display: flex;
            gap: 8px;
        }
        .btn {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-trigger {
            background: rgba(231, 111, 81, 0.2);
            color: #e76f51;
            border: 1px solid rgba(231, 111, 81, 0.3);
        }
        .btn-trigger:hover { background: rgba(231, 111, 81, 0.3); }
        .btn-view {
            background: rgba(94, 129, 172, 0.2);
            color: #5e81ac;
            border: 1px solid rgba(94, 129, 172, 0.3);
        }
        .btn-view:hover { background: rgba(94, 129, 172, 0.3); }

        /* Workflow Section */
        .workflow {
            background: rgba(129, 178, 154, 0.1);
            border: 1px solid rgba(129, 178, 154, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .workflow h2 {
            color: #81b29a;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: center;
        }
        .workflow-steps {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
        }
        .workflow-step {
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        .step-num {
            width: 40px;
            height: 40px;
            background: rgba(129, 178, 154, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            color: #81b29a;
        }
        .step-text { font-size: 0.85rem; color: #aaa; }
        .step-arrow {
            color: #81b29a;
            font-size: 1.5rem;
            align-self: center;
        }

        /* Log Panel */
        .log-panel {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .log-title { color: #81b29a; font-size: 0.9rem; }
        .log-clear {
            font-size: 0.75rem;
            padding: 4px 10px;
            background: transparent;
            border: 1px solid #30363d;
            color: #666;
            border-radius: 6px;
            cursor: pointer;
        }
        .log-content {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
            color: #8b949e;
        }
        .log-entry { padding: 4px 0; border-bottom: 1px solid #21262d; }
        .log-entry.error { color: #f85149; }
        .log-entry.success { color: #81b29a; }
        .log-entry.info { color: #58a6ff; }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .quick-btn {
            padding: 12px 24px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #e0e0e0;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quick-btn:hover { background: rgba(255,255,255,0.1); }
        .quick-btn.primary {
            background: rgba(129, 178, 154, 0.2);
            border-color: rgba(129, 178, 154, 0.4);
            color: #81b29a;
        }
        .quick-btn.danger {
            background: rgba(231, 111, 81, 0.2);
            border-color: rgba(231, 111, 81, 0.4);
            color: #e76f51;
        }

        /* ROI Preview */
        .roi-preview {
            background: linear-gradient(135deg, rgba(129, 178, 154, 0.1), rgba(94, 129, 172, 0.1));
            border: 1px solid rgba(129, 178, 154, 0.2);
            border-radius: 12px;
            padding: 15px 20px;
            margin-top: 20px;
            text-align: center;
        }
        .roi-preview h3 {
            color: #81b29a;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .roi-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
        }
        .roi-stat {
            text-align: center;
        }
        .roi-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
        }
        .roi-label {
            font-size: 0.7rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª FixOnce - ××¢×‘×“×ª ×‘×“×™×§×•×ª</h1>
        <p class="subtitle">×ª×¨×—×™×©×™× ×××™×ª×™×™× ×œ×‘×“×™×§×ª AI Memory Layer</p>

        <!-- Workflow -->
        <div class="workflow">
            <h2>ğŸ”„ ×ª×”×œ×™×š ×”×‘×“×™×§×”</h2>
            <div class="workflow-steps">
                <div class="workflow-step">
                    <div class="step-num">1</div>
                    <div class="step-text">×”×¤×¢×œ ×©×’×™××”<br><small>×œ×—×¥ "Trigger"</small></div>
                </div>
                <span class="step-arrow">â†’</span>
                <div class="workflow-step">
                    <div class="step-num">2</div>
                    <div class="step-text">×¤×ª×— Claude Code<br><small>×××•×¨ "×”×™×™"</small></div>
                </div>
                <span class="step-arrow">â†’</span>
                <div class="workflow-step">
                    <div class="step-num">3</div>
                    <div class="step-text">Claude ××ª×§×Ÿ<br><small>×§×•×¨× + ××ª×§×Ÿ ×”×§×•×‘×¥</small></div>
                </div>
                <span class="step-arrow">â†’</span>
                <div class="workflow-step">
                    <div class="step-num">4</div>
                    <div class="step-text">×©×™×—×” ×—×“×©×”<br><small>×¨××” ×©×”×¤×ª×¨×•×Ÿ × ×©××¨</small></div>
                </div>
            </div>
        </div>

        <!-- Scenarios -->
        <div class="scenarios">
            <!-- Scenario 1 -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-num">×ª×¨×—×™×© 1</span>
                    <span class="scenario-lang">JavaScript</span>
                </div>
                <div class="scenario-title">TypeError: undefined.map()</div>
                <div class="scenario-desc">
                    ×‘××’ ×§×œ××¡×™ ×‘-React ×›×©×“××˜× ×¢×“×™×™×Ÿ ×œ× × ×˜×¢×Ÿ ×-API.
                    ×”×¤×ª×¨×•×Ÿ: optional chaining ××• ×‘×“×™×§×ª null.
                </div>
                <div class="scenario-file">scenarios/scenario1_undefined_map.js:13</div>
                <div class="scenario-actions">
                    <button class="btn btn-trigger" onclick="triggerScenario(1)">ğŸ”¥ Trigger</button>
                    <button class="btn btn-view" onclick="viewScenario(1)">ğŸ‘ï¸ View Code</button>
                </div>
            </div>

            <!-- Scenario 2 -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-num">×ª×¨×—×™×© 2</span>
                    <span class="scenario-lang">JavaScript</span>
                </div>
                <div class="scenario-title">Unhandled Promise Rejection</div>
                <div class="scenario-desc">
                    async/await ×‘×œ×™ try/catch. ×›×©×”×¨×©×ª × ×•×¤×œ×ª - ×”×›×œ ×§×•×¨×¡.
                    ×”×¤×ª×¨×•×Ÿ: ×¢×˜×™×¤×” ×‘-try/catch + ×‘×“×™×§×ª response.ok.
                </div>
                <div class="scenario-file">scenarios/scenario2_async_await.js:9</div>
                <div class="scenario-actions">
                    <button class="btn btn-trigger" onclick="triggerScenario(2)">ğŸ”¥ Trigger</button>
                    <button class="btn btn-view" onclick="viewScenario(2)">ğŸ‘ï¸ View Code</button>
                </div>
            </div>

            <!-- Scenario 3 -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-num">×ª×¨×—×™×© 3</span>
                    <span class="scenario-lang">Python</span>
                </div>
                <div class="scenario-title">KeyError: 'email'</div>
                <div class="scenario-desc">
                    ×’×™×©×” ×œ××¤×ª×— ×©×œ× ×§×™×™× ×‘-dict.
                    ×”×¤×ª×¨×•×Ÿ: ×©×™××•×© ×‘-.get() ×¢× ×‘×¨×™×¨×ª ××—×“×œ.
                </div>
                <div class="scenario-file">scenarios/scenario3_key_error.py:20</div>
                <div class="scenario-actions">
                    <button class="btn btn-trigger" onclick="triggerScenario(3)">ğŸ”¥ Trigger</button>
                    <button class="btn btn-view" onclick="viewScenario(3)">ğŸ‘ï¸ View Code</button>
                </div>
            </div>

            <!-- Scenario 4 -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-num">×ª×¨×—×™×© 4</span>
                    <span class="scenario-lang">JavaScript</span>
                </div>
                <div class="scenario-title">Cannot read property of null</div>
                <div class="scenario-desc">
                    ××œ×× ×˜ DOM ×œ× ×§×™×™× ××• ××•×‘×™×™×§×˜ ××§×•× ×Ÿ ×¢× null.
                    ×”×¤×ª×¨×•×Ÿ: ×‘×“×™×§×” ×× ×§×™×™× + optional chaining.
                </div>
                <div class="scenario-file">scenarios/scenario4_null_reference.js:12</div>
                <div class="scenario-actions">
                    <button class="btn btn-trigger" onclick="triggerScenario(4)">ğŸ”¥ Trigger</button>
                    <button class="btn btn-view" onclick="viewScenario(4)">ğŸ‘ï¸ View Code</button>
                </div>
            </div>
        </div>

        <!-- Log Panel -->
        <div class="log-panel">
            <div class="log-header">
                <span class="log-title">ğŸ“‹ Activity Log</span>
                <button class="log-clear" onclick="clearLog()">Clear</button>
            </div>
            <div class="log-content" id="log-content">
                <div class="log-entry info">Ready. Click a scenario to start.</div>
            </div>
        </div>

        <!-- MEGA TEST - Full FixOnce Demo -->
        <div class="workflow" style="background: linear-gradient(135deg, rgba(94, 129, 172, 0.15), rgba(129, 178, 154, 0.15)); border-color: rgba(94, 129, 172, 0.3);">
            <h2>ğŸš€ ×‘×“×™×§×” ××œ××” - ×›×œ ×”×™×›×•×œ×•×ª</h2>
            <p style="text-align: center; color: #888; margin-bottom: 20px; font-size: 0.85rem;">
                ×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×œ×”×“×’××” ××•×˜×•××˜×™×ª ×©×œ ×›×œ ×”×¤×™×¦'×¨×™× - ××•×©×œ× ×œ××©×ª××© ×—×“×© ××• ×œ×”×“×’××”
            </p>
            <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                <button class="quick-btn primary" onclick="runFullDemo()" style="font-size: 1.1rem; padding: 15px 40px;">
                    â–¶ï¸ ×”×¤×¢×œ ×‘×“×™×§×” ××œ××”
                </button>
                <button class="quick-btn" onclick="runSafetyDemo()" style="padding: 15px 30px;">
                    ğŸ›¡ï¸ ×”×“×’××ª Safety Switch
                </button>
            </div>
            <div id="demo-progress" style="margin-top: 20px; display: none;">
                <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #81b29a; font-size: 0.85rem;">×”×ª×§×“××•×ª</span>
                        <span id="demo-step" style="color: #fff; font-size: 0.85rem;">0/8</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); border-radius: 4px; height: 8px; overflow: hidden;">
                        <div id="demo-progress-bar" style="background: linear-gradient(90deg, #81b29a, #5e81ac); height: 100%; width: 0%; transition: width 0.5s;"></div>
                    </div>
                    <p id="demo-status" style="color: #aaa; font-size: 0.8rem; margin-top: 10px; text-align: center;"></p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-btn primary" onclick="setProjectRoot()">ğŸ“ Set Project Root</button>
            <button class="quick-btn" onclick="openDashboard()">ğŸ“Š Open Dashboard</button>
            <button class="quick-btn" onclick="checkROI()">ğŸ’° Check ROI</button>
            <button class="quick-btn" onclick="simulateFullFlow()">ğŸ”„ Simulate Full Flow</button>
            <button class="quick-btn danger" onclick="clearAllData()">ğŸ—‘ï¸ Reset All</button>
        </div>

        <!-- ROI Preview -->
        <div class="roi-preview" id="roi-preview" style="display:none;">
            <h3>ğŸ“Š ROI ××¢×•×“×›×Ÿ</h3>
            <div class="roi-stats">
                <div class="roi-stat">
                    <div class="roi-value" id="preview-time">0m</div>
                    <div class="roi-label">×–××Ÿ ×©× ×—×¡×š</div>
                </div>
                <div class="roi-stat">
                    <div class="roi-value" id="preview-tokens">0</div>
                    <div class="roi-label">×˜×•×§× ×™×</div>
                </div>
                <div class="roi-stat">
                    <div class="roi-value" id="preview-solutions">0</div>
                    <div class="roi-label">×¤×ª×¨×•× ×•×ª</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API = 'http://localhost:5000';
        const PROJECT_ROOT = '/Users/haimdayan/Desktop/FixOnce/test-site';

        const scenarios = {
            1: {
                type: 'TypeError',
                message: "Cannot read properties of undefined (reading 'map')",
                file: `${PROJECT_ROOT}/scenarios/scenario1_undefined_map.js`,
                line: '13',
                solution: 'Add optional chaining: products?.map() instead of products.map()'
            },
            2: {
                type: 'UnhandledPromiseRejection',
                message: 'Failed to fetch: Network request failed without error handling',
                file: `${PROJECT_ROOT}/scenarios/scenario2_async_await.js`,
                line: '9',
                solution: 'Wrap fetch in try/catch and check response.ok'
            },
            3: {
                type: 'KeyError',
                message: "KeyError: 'email' - Accessing missing dictionary key",
                file: `${PROJECT_ROOT}/scenarios/scenario3_key_error.py`,
                line: '20',
                solution: 'Use dict.get("email", default) instead of dict["email"]'
            },
            4: {
                type: 'TypeError',
                message: "Cannot read properties of null (reading 'textContent')",
                file: `${PROJECT_ROOT}/scenarios/scenario4_null_reference.js`,
                line: '12',
                solution: 'Check if element exists before accessing: if (element) { element.textContent = ... }'
            }
        };

        function log(message, type = 'info') {
            const content = document.getElementById('log-content');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            content.appendChild(entry);
            content.scrollTop = content.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log-content').innerHTML = '<div class="log-entry info">Log cleared.</div>';
        }

        async function triggerScenario(num) {
            const scenario = scenarios[num];
            log(`Triggering Scenario ${num}: ${scenario.type}`, 'error');

            try {
                const response = await fetch(`${API}/api/log_error`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: scenario.type,
                        message: scenario.message,
                        source: `${scenario.file}:${scenario.line}`,
                        severity: 'error',
                        file: scenario.file,
                        line: scenario.line
                    })
                });

                const result = await response.json();
                if (result.status === 'ok') {
                    log(`âœ“ Error sent to FixOnce. Check dashboard.`, 'success');
                    log(`File: ${scenario.file}:${scenario.line}`, 'info');
                }
            } catch (e) {
                log(`Failed to send error: ${e.message}`, 'error');
            }
        }

        function viewScenario(num) {
            const scenario = scenarios[num];
            const path = scenario.file;
            log(`View file: ${path}`, 'info');
            log(`Tell Claude: "Read ${path} and fix the bug"`, 'info');

            // Copy path to clipboard
            navigator.clipboard.writeText(path).then(() => {
                log('Path copied to clipboard!', 'success');
            });
        }

        function openDashboard() {
            window.open(`${API}/brain`, '_blank');
        }

        async function setProjectRoot() {
            log('Setting project root path...', 'info');
            try {
                const response = await fetch(`${API}/api/memory/project/root`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ root_path: PROJECT_ROOT })
                });
                const result = await response.json();
                if (result.status === 'ok') {
                    log(`âœ“ Project root set: ${result.root_path}`, 'success');
                    log(`Project: ${result.name} | Stack: ${result.stack}`, 'info');
                } else {
                    log(`Failed: ${result.message}`, 'error');
                }
            } catch (e) {
                log(`Error: ${e.message}`, 'error');
            }
        }

        async function checkROI() {
            try {
                const response = await fetch(`${API}/api/memory/roi`);
                const roi = await response.json();

                document.getElementById('preview-time').textContent = roi.time_saved_formatted || '0';
                document.getElementById('preview-tokens').textContent = roi.tokens_saved_formatted || '0';
                document.getElementById('preview-solutions').textContent = roi.solutions_reused || 0;

                document.getElementById('roi-preview').style.display = 'block';

                log(`ROI: ${roi.time_saved_formatted} saved, ${roi.tokens_saved_formatted} tokens`, 'success');
            } catch (e) {
                log(`Failed to load ROI: ${e.message}`, 'error');
            }
        }

        async function simulateFullFlow() {
            log('=== Starting Full Flow Simulation ===', 'info');

            // Step 1: Trigger error
            log('Step 1: Triggering error...', 'info');
            await triggerScenario(1);

            // Step 2: Simulate solution found and applied
            log('Step 2: Simulating solution found in memory...', 'info');
            await fetch(`${API}/api/memory/roi/track`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ event: 'solution_reused' })
            });

            // Step 3: Simulate session with context
            log('Step 3: Simulating session with context...', 'info');
            await fetch(`${API}/api/memory/roi/track`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ event: 'session_context' })
            });

            log('=== Flow Complete! Check ROI ===', 'success');
            await checkROI();
        }

        async function clearAllData() {
            if (!confirm('This will clear all FixOnce data. Continue?')) return;

            try {
                await fetch(`${API}/api/memory/clear-issues`, { method: 'POST' });
                await fetch(`${API}/api/memory/clear-history`, { method: 'POST' });
                await fetch(`${API}/api/memory/handover`, { method: 'DELETE' });
                await fetch(`${API}/api/memory/roi/reset`, { method: 'POST' });

                log('All data cleared!', 'success');
                document.getElementById('roi-preview').style.display = 'none';
            } catch (e) {
                log(`Failed to clear: ${e.message}`, 'error');
            }
        }

        // Check server on load
        fetch(`${API}/api/status`)
            .then(r => r.json())
            .then(data => log('Connected to FixOnce server', 'success'))
            .catch(e => log('Server not running! Start with: python3 server.py', 'error'));

        // ========== FULL DEMO ==========
        async function runFullDemo() {
            const steps = [
                { name: '× ×™×§×•×™ × ×ª×•× ×™× ×§×•×“××™×', action: clearAllDataSilent },
                { name: '×”×’×“×¨×ª Project Root', action: setProjectRootSilent },
                { name: '×©×œ×™×—×ª ×©×’×™××” ×œ×“×•×’××”', action: () => triggerScenario(1) },
                { name: '×”×•×¡×¤×ª ×”×—×œ×˜×” ××¨×›×™×˜×§×˜×•×¨×™×ª', action: addDemoDecision },
                { name: '×”×•×¡×¤×ª Avoid Pattern', action: addDemoAvoid },
                { name: '×‘×“×™×§×ª Safety Switch', action: runSafetyDemo },
                { name: '×™×¦×™×¨×ª Handover', action: createDemoHandover },
                { name: '×¢×“×›×•×Ÿ ROI', action: updateDemoROI }
            ];

            const progressEl = document.getElementById('demo-progress');
            const stepEl = document.getElementById('demo-step');
            const barEl = document.getElementById('demo-progress-bar');
            const statusEl = document.getElementById('demo-status');

            progressEl.style.display = 'block';
            log('=== ğŸš€ ××ª×—×™×œ ×‘×“×™×§×” ××œ××” ===', 'info');

            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                stepEl.textContent = `${i + 1}/${steps.length}`;
                barEl.style.width = `${((i + 1) / steps.length) * 100}%`;
                statusEl.textContent = step.name + '...';
                log(`Step ${i + 1}: ${step.name}`, 'info');

                try {
                    await step.action();
                    await sleep(800);
                } catch (e) {
                    log(`Error in step ${i + 1}: ${e.message}`, 'error');
                }
            }

            statusEl.textContent = 'âœ… ×”×‘×“×™×§×” ×”×•×©×œ××”! ×¤×ª×— ××ª ×”×“×©×‘×•×¨×“ ×œ×¨××•×ª ××ª ×”×ª×•×¦××•×ª';
            log('=== âœ… ×‘×“×™×§×” ××œ××” ×”×•×©×œ××”! ===', 'success');
            log('×¤×ª×— ××ª http://localhost:5000 ×œ×¨××•×ª ××ª ×›×œ ×”× ×ª×•× ×™×', 'info');

            await checkROI();
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function clearAllDataSilent() {
            await fetch(`${API}/api/memory/clear-issues`, { method: 'POST' });
            await fetch(`${API}/api/memory/clear-history`, { method: 'POST' });
            await fetch(`${API}/api/memory/handover`, { method: 'DELETE' });
            await fetch(`${API}/api/memory/roi/reset`, { method: 'POST' });
            // Clear decisions
            const decisions = await fetch(`${API}/api/memory/decisions`).then(r => r.json());
            for (const d of (decisions.decisions || [])) {
                await fetch(`${API}/api/memory/decisions/${d.id}`, { method: 'DELETE' });
            }
            // Clear avoid
            const avoids = await fetch(`${API}/api/memory/avoid`).then(r => r.json());
            for (const a of (avoids.avoid || [])) {
                await fetch(`${API}/api/memory/avoid/${a.id}`, { method: 'DELETE' });
            }
            log('âœ“ × ×ª×•× ×™× ×§×•×“××™× × ×•×§×•', 'success');
        }

        async function setProjectRootSilent() {
            await fetch(`${API}/api/memory/project/root`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ root_path: PROJECT_ROOT })
            });
            log('âœ“ Project root ×”×•×’×“×¨', 'success');
        }

        async function addDemoDecision() {
            await fetch(`${API}/api/memory/decisions`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    decision: '×©×™××•×© ×‘-Optional Chaining ×œ×›×œ ×’×™×©×” ×œ× ×ª×•× ×™×',
                    reason: '××•× ×¢ TypeError ×›×©-data ×¢×“×™×™×Ÿ ×œ× × ×˜×¢×Ÿ'
                })
            });
            log('âœ“ ×”×—×œ×˜×” ××¨×›×™×˜×§×˜×•×¨×™×ª × ×•×¡×¤×”', 'success');
        }

        async function addDemoAvoid() {
            await fetch(`${API}/api/memory/avoid`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    what: '×œ× ×œ×”×©×ª××© ×‘-.map() ×™×©×™×¨×•×ª ×¢×œ ××©×ª× ×” ×©×™×›×•×œ ×œ×”×™×•×ª undefined',
                    reason: '×’×•×¨× ×œ-TypeError, ×ª××™×“ ×œ×‘×“×•×§ ×§×•×“× ××• ×œ×”×©×ª××© ×‘-?.'
                })
            });
            log('âœ“ Avoid Pattern × ×•×¡×£', 'success');
        }

        async function createDemoHandover() {
            await fetch(`${API}/api/memory/handover`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    summary: `## Done: ×‘×“×™×§×ª ××¢×¨×›×ª FixOnce
- ×”×•×¡×¤×ª×™ ×©×’×™××” ×œ×“×•×’××” (TypeError)
- ×”×’×“×¨×ª×™ ×”×—×œ×˜×” ××¨×›×™×˜×§×˜×•×¨×™×ª ×¢×œ Optional Chaining
- ×”×’×“×¨×ª×™ Avoid Pattern ×œ×× ×™×¢×ª .map() ×¢×œ undefined
- ×‘×“×§×ª×™ ××ª Safety Switch

## Next: ×”××©×š ×œ×ª×§×Ÿ ××ª ×”×©×’×™××•×ª ×‘×¨×©×™××”`
                })
            });
            log('âœ“ Handover × ×•×¦×¨', 'success');
        }

        async function updateDemoROI() {
            await fetch(`${API}/api/memory/roi/track`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ event: 'solution_reused' })
            });
            await fetch(`${API}/api/memory/roi/track`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ event: 'session_context' })
            });
            log('âœ“ ROI ×¢×•×“×›×Ÿ', 'success');
        }

        // ========== SAFETY SWITCH DEMO ==========
        async function runSafetyDemo() {
            log('=== ğŸ›¡ï¸ ×”×“×’××ª Safety Switch ===', 'info');

            // Step 1: Check current settings
            const settings = await fetch(`${API}/api/safety/settings`).then(r => r.json());
            log(`Safety Switch: ${settings.enabled ? '××•×¤×¢×œ âœ“' : '×›×‘×•×™'}`, 'info');

            // Step 2: Create a pending change
            log('×™×•×¦×¨ ×©×™× ×•×™ ×œ××™×©×•×¨...', 'info');
            const changeResult = await fetch(`${API}/api/safety/changes/preview`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    file_path: '/tmp/fixonce_demo.js',
                    new_content: `// FixOnce Demo File
const data = null;

// FIXED: Using optional chaining
const items = data?.items ?? [];
console.log('Items count:', items.length);
`,
                    description: '×”×•×¡×¤×ª Optional Chaining ×œ×× ×™×¢×ª TypeError'
                })
            }).then(r => r.json());

            if (changeResult.change_id) {
                log(`âœ“ ×©×™× ×•×™ × ×•×¦×¨: ${changeResult.change_id}`, 'success');
                log('Diff:', 'info');
                log(changeResult.diff?.substring(0, 200) + '...', 'info');

                // Step 3: Approve and apply
                await sleep(500);
                log('×××©×¨ ×•××—×™×œ ××ª ×”×©×™× ×•×™...', 'info');

                await fetch(`${API}/api/safety/changes/${changeResult.change_id}/approve`, { method: 'POST' });
                const applyResult = await fetch(`${API}/api/safety/changes/${changeResult.change_id}/apply`, { method: 'POST' }).then(r => r.json());

                if (applyResult.status === 'ok') {
                    log('âœ“ ×”×©×™× ×•×™ ×”×•×—×œ ×‘×”×¦×œ×—×”!', 'success');
                    log(`Backup × ×©××¨ ×‘: ${applyResult.backup_path}`, 'info');

                    // Step 4: Undo the change
                    await sleep(500);
                    log('××‘×˜×œ ××ª ×”×©×™× ×•×™ (Undo)...', 'info');
                    const undoResult = await fetch(`${API}/api/safety/undo/${changeResult.change_id}`, { method: 'POST' }).then(r => r.json());

                    if (undoResult.status === 'ok') {
                        log('âœ“ ×”×©×™× ×•×™ ×‘×•×˜×œ ×‘×”×¦×œ×—×”!', 'success');
                    }
                }

                // Show history
                await sleep(300);
                const history = await fetch(`${API}/api/safety/history?limit=3`).then(r => r.json());
                log(`×”×™×¡×˜×•×¨×™×™×ª ×©×™× ×•×™×™×: ${history.count} ×©×™× ×•×™×™×`, 'info');
            }

            log('=== ğŸ›¡ï¸ ×”×“×’××ª Safety Switch ×”×•×©×œ××” ===', 'success');
        }
    </script>
</body>
</html>
